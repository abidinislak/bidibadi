<!DOCTYPE html>
<html>

<head xmlns:th="http://www.thymeLeaf.org">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name"viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
	<title>[[${pageTitle}]]</title>


	<link rel="styLesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
	<script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}">	</script>
	<script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}">



	</script>
</head>

<body>

	<div class="container-fluid">


		<div>

			<nav class="navbar navbar-expand-lg bg-dark navbar-dark">


				<a class="navbar-brand" th:href=" @{/} ">
					<img th:src=" @{/images/logo.jpeg} " width=" 100" height="100">
				</a>

				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topNavbar">

					<span class="navbar-toggler-icon"></span>

				</button>

				<div class="collapse navbar-collapse" id="topNavbar">

					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/users} "> Kullanıcılar </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/categories} "> Kategoriler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/brands} "> Markalar </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/products} "> Ürünler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/customers} "> Müşteriler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/shipping} "> Kargo </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/orders} "> Siparişler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/report} "> Raporlar </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/articles} "> Makaleler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/menus} "> Menüler </a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href=" @{/users} "> Ayarlar </a>
						</li>

					</ul>
				</div>
			</nav>

		</div>


		<div>

			<h1>Manage Users - [[${pageTitle}]] </h1>

		</div>


		<form th:action="@{/users/save}" method="post" enctype="multipart/form-data"
			style="max-width: 700px; margin: 0 auto" th:object="${user}" onsubmit="return checkEmailUnique(this);">
			<input type="hidden" th:field="*{id}" />
			<div class="border border-secondary rounded  p-3">
				<div class="form-group row">

					<label class="col-sm-4 col-form-label"> Email</label>
					<div class="col-sm-8">

						<input type="email" th:field="*{email}" maxlength="128" required minlength="8"
							class="form-control">
					</div>
				</div>


				<div class="form-group row">

					<label class="col-sm-4 col-form-label"> İsim</label>
					<div class="col-sm-8">

						<input type="text" th:field="*{firstname}" maxlength="45" required minlength="2"
							class="form-control">
					</div>
				</div>

				<div class="form-group row">

					<label class="col-sm-4 col-form-label"> Soy İsim</label>
					<div class="col-sm-8">

						<input type="text" th:field="*{lastname}" maxlength="45" required minlength="2"
							class="form-control">
					</div>
				</div>


				<div class="form-group row">

					<label class="col-sm-4 col-form-label">Parola</label>
					<div class="col-sm-8">

						<input type="password" th:if="${user.id == null} " th:field="*{password}" maxlength="20"
							required minlength="8" class="form-control">
						<input type="password" th:if="${user.id != null} " th:field="*{password}" maxlength="20"
							minlength="8" class="form-control">
					</div>
				</div>



				<div class="form-group row">

					<label class="col-sm-4 col-form-label">Roles</label>
					<div class="col-sm-8">


						<th:block th:each="role : ${listRoles}">

							<input type="checkbox" th:field="*{roles}" class="m-2" th:text="${role.name}"
								th:value="${role.id}">

							- <small>[[${role.description}]]</small>

							<br />


						</th:block>











					</div>
				</div>

				<div class="form-group row">

					<label class="col-sm-4 col-form-label"> Aktif mi ?</label>
					<div class="col-sm-8">


						<input type="checkbox" th:field="*{enabled}" class="form-control">



					</div>
				</div>



				<div class="form-group row">

					<label class="col-sm-4 col-form-label"> Fotograf</label>
					<div class="col-sm-8">

						<input  type="hidden" th:field="*{photos}"  />

						<input type="file" name="image" class="mb-2" id="fileImage" accept="image/png, image/jpeg">


						<img class="img-fluid" id="thumbnail" alt="Photos preview"
							th:src="@{${user.photosImagePath}}" />

					</div>
				</div>





				<div class="text-center">

					<input type="submit" value="Kaydet" class="btn btn-primary m-3" />
					<input type="button" value="Vazgeç" class="btn btn-secondary" id="buttonCancel" />

				</div>


			</div>

		</form>

		<div class="modal fade  text-center" id="modalDialog">
			<div class="modal-dialog">
				<div class="modal-content">

					<div class="modal-header">


						<h4 class="modal-title" id="modalTitle">Dikkat</h4>
						<button type="button" class="close" data-dismiss="modal">&times</button>
					</div>

					<div class="modal-body">




						<span id="modalBody">


						</span></div>


					<div class="modal-footer">


						<button type="button" class="btn btn-danger" data-dismiss="modal">close</button>


					</div>




				</div>

			</div>

		</div>


		<div class="text-center">
			<p>BidiBadi Control Panel - Copyright &copy; BidiBadi</p>

		</div>
	</div>
</body>

<script type="text/javascript">


	moduleURL = "[[@{/users}]]";


	$(document).ready(function () {
		$("#fileImage").change(function () {

			showImageThumbnail(this);



			fileSize = this.files[0].size;


			if (fileSize > 1048576) {
				this.setCustomValidity("!mb dan kucuk fotoyuklemelisiniz");
				this.reportValidity();
			}


			else {


			}
		});
	});

	function showImageThumbnail(fileInput) {


		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function (e) {


			$("#thumbnail").attr("src", e.target.result);
		};
		reader.readAsDataURL(file);

	}


	function checkEmailUnique(form) {
		url = "[[@{/users/check_email}]]";
		userEmail = $("#email").val();
		userId = $("#id").val();
		csrfValue = $("input[name='_csrf']").val();

		params = {id: userId, email: userEmail, _csrf: csrfValue};




		$.post(url, params, function (response) {
			if (response == "OK") {

				form.submit();
			} else if (response == "Duplicated") {

				showModalDialog("Dikkat", "UUOOPPSS...  Sanırım bu email kullanılmaktadır : " + userEmail);
			} else {
				showModalDialog("Hata", "UUOOPPSS...  sunucudan kaynaklı bilinmeyen hata");
			}
		}).fail(function () {
			showModalDialog("Hata", "Sunucuya baglantı hatası");
		});

		return false;
	}

	function showModalDialog(title, message) {

		$("#modalTitle").text(title);
		$("#modalBody").text(message);




		$("#modalDialog").modal();



	}



</script>

</html>